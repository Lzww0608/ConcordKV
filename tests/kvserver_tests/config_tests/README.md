# ConcordKV 配置系统测试

本目录包含ConcordKV存储引擎配置系统的测试程序。

## 测试内容

### test_config_system.c
配置系统综合测试程序，包含以下测试用例：

1. **配置对象创建和销毁测试**
   - 验证配置对象的正确创建
   - 验证默认配置值的正确性
   - 验证配置对象的正确销毁

2. **配置文件加载测试**
   - 测试从JSON配置文件加载配置
   - 测试加载不存在配置文件的错误处理
   - 验证配置文件中各项参数的正确解析

3. **环境变量配置测试**
   - 测试从环境变量加载配置
   - 验证环境变量优先级
   - 测试环境变量的正确解析

4. **配置验证测试**
   - 测试配置参数的有效性验证
   - 测试无效配置的错误检测
   - 验证配置约束条件

5. **引擎管理器测试**
   - 测试引擎管理器的创建和初始化
   - 验证引擎实例的正确创建
   - 测试引擎管理器的资源管理

6. **引擎切换测试**
   - 测试运行时引擎切换功能
   - 验证引擎切换的正确性
   - 测试多种存储引擎的切换

7. **基本存储操作测试**
   - 测试通过配置系统进行基本CRUD操作
   - 验证不同引擎的操作一致性
   - 测试引擎切换后的数据操作

8. **字符串转换函数测试**
   - 测试引擎类型字符串转换
   - 测试策略类型字符串转换
   - 验证转换函数的正确性

## 编译和运行

### 编译测试程序
```bash
cd ConcordKV/kvserver
make test_config_system
```

### 运行测试
```bash
# 运行配置系统测试
make run_config_test

# 或直接运行
./test_config_system
```

## 测试依赖

测试程序依赖以下组件：
- 配置系统模块 (kv_engine_config.h/c)
- 存储引擎接口 (kv_engine_interface.h)
- 存储引擎工厂 (kv_engine_factory.c)
- 通用配置系统 (common/config/)
- 内存管理模块 (kv_memory.h/c)
- 错误处理模块 (kv_error.h/c)

## 测试数据

测试程序会在运行时创建临时测试数据目录：
- `./test_data/` - 主测试数据目录
- `./test_data/array/` - Array引擎测试数据
- `./test_data/rbtree/` - RBTree引擎测试数据
- `./test_data/hash/` - Hash引擎测试数据
- `./test_data/btree/` - BTree引擎测试数据
- `./test_data/lsm/` - LSM引擎测试数据

测试完成后会自动清理这些临时目录。

## 预期结果

所有测试用例都应该通过，输出类似：
```
🔧 ConcordKV 配置系统测试开始
================================
...
✅ 所有测试通过！
总测试数: XX
通过测试: XX
失败测试: 0
```

## 故障排除

如果测试失败，请检查：
1. 是否有足够的文件系统权限创建测试目录
2. 配置文件 `engine_config.json` 是否存在且格式正确
3. 所有依赖的存储引擎模块是否正确编译
4. 系统是否有足够的内存运行测试

## 扩展测试

可以通过以下方式扩展测试：
1. 添加更多配置文件格式的测试（YAML、TOML等）
2. 添加并发配置操作的测试
3. 添加配置热重载的测试
4. 添加配置持久化的测试
5. 添加更复杂的引擎切换场景测试 