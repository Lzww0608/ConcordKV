# ConcordKV

**é«˜æ€§èƒ½åˆ†å¸ƒå¼é”®å€¼å­˜å‚¨ç³»ç»Ÿ**

ConcordKVæ˜¯ä¸€ä¸ªä½¿ç”¨Cè¯­è¨€å®ç°çš„é«˜æ€§èƒ½ã€åˆ†å¸ƒå¼é”®å€¼å­˜å‚¨ç³»ç»Ÿï¼Œç›®æ ‡æ˜¯æä¾›ACIDäº‹åŠ¡æ”¯æŒã€å¤šç§å­˜å‚¨å¼•æ“ã€å¼ºä¸€è‡´æ€§ä¿è¯å’Œæ°´å¹³æ‰©å±•èƒ½åŠ›ã€‚

## ğŸŒŸ æ ¸å¿ƒç‰¹æ€§

### ğŸ¯ å¤šç§å­˜å‚¨å¼•æ“
- **Arrayå­˜å‚¨å¼•æ“** - é€‚ç”¨äºå°è§„æ¨¡æ•°æ®å’Œå¿«é€ŸåŸå‹
- **Hashå­˜å‚¨å¼•æ“** - é«˜æ€§èƒ½å“ˆå¸Œè¡¨å®ç°ï¼Œæ”¯æŒO(1)æŸ¥æ‰¾
- **RBTreeå­˜å‚¨å¼•æ“** - çº¢é»‘æ ‘å®ç°ï¼Œä¿è¯O(log n)æœ‰åºæ“ä½œ
- **B+Treeå­˜å‚¨å¼•æ“** â­ - é«˜æ€§èƒ½å­˜å‚¨å¼•æ“ï¼Œæ”¯æŒèŒƒå›´æŸ¥è¯¢å’Œé«˜å¹¶å‘
- **LSM-Tree MemTable** ğŸ”¥ - **æ–°å¢**å†™ä¼˜åŒ–å­˜å‚¨å¼•æ“ï¼Œæ”¯æŒé«˜ååé‡å†™å…¥

### ğŸ”„ åˆ†å¸ƒå¼äº‹åŠ¡
- **ä¸¤é˜¶æ®µæäº¤(2PC)åè®®** - ä¿è¯åˆ†å¸ƒå¼äº‹åŠ¡çš„ACIDç‰¹æ€§
- **ä¼˜å…ˆçº§è°ƒåº¦ç³»ç»Ÿ** - æ™ºèƒ½äº‹åŠ¡è°ƒåº¦ï¼Œé¿å…æ­»é”
- **è¶…æ—¶æ£€æµ‹ä¸æ¢å¤** - è‡ªåŠ¨æ£€æµ‹å’Œæ¢å¤æ•…éšœäº‹åŠ¡
- **ç½‘ç»œæ•…éšœå®¹é”™** - åˆ†åŒºå®¹å¿æ€§è®¾è®¡

### ğŸš€ é«˜æ€§èƒ½ä¸å¹¶å‘
- **æ— é”è®¾è®¡** - å…³é”®è·¯å¾„é‡‡ç”¨æ— é”æ•°æ®ç»“æ„
- **å¤šçº§é”æœºåˆ¶** - ç²’åº¦å¯æ§çš„å¹¶å‘æ§åˆ¶
- **æ‰¹é‡å†™å…¥ä¼˜åŒ–** âš¡ - **æ–°å¢**å‡å°‘é”ç«äº‰ï¼Œæ™ºèƒ½å»é‡ï¼Œé«˜å¹¶å‘æ‰¹é‡æ“ä½œ
- **å†…å­˜æ± ç®¡ç†** - å‡å°‘å†…å­˜åˆ†é…å¼€é”€
- **é›¶æ‹·è´I/O** - é«˜æ•ˆçš„æ•°æ®ä¼ è¾“

### ğŸ“Š ç”Ÿäº§çº§åŠŸèƒ½
- **é…ç½®ç®¡ç†ç³»ç»Ÿ** ğŸ”§ - **æ–°å¢**ç»Ÿä¸€é…ç½®ç®¡ç†ï¼Œæ”¯æŒè¿è¡Œæ—¶å¼•æ“åˆ‡æ¢
- **WALæ—¥å¿—** - å†™å‰æ—¥å¿—ä¿è¯æ•°æ®æŒä¹…æ€§
- **å¿«ç…§å¤‡ä»½** - æ”¯æŒå¢é‡å’Œå…¨é‡å¤‡ä»½
- **é›†ç¾¤ç®¡ç†** - è‡ªåŠ¨æ•…éšœæ£€æµ‹å’Œæ¢å¤
- **ç›‘æ§æŒ‡æ ‡** - ä¸°å¯Œçš„æ€§èƒ½ç›‘æ§æ•°æ®

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### LSM-Tree MemTable ğŸ”¥ **å†™ä¼˜åŒ–æ¨è**
- **æ’å…¥æ€§èƒ½**: 819,036 ops/sec (é«˜ååé‡å†™å…¥)
- **æŸ¥æ‰¾æ€§èƒ½**: 2,632,391 ops/sec (è¶…é«˜è¯»å–æ•ˆç‡)
- **å†…å­˜æ•ˆç‡**: 145å­—èŠ‚/æ¡ç›® (åŒ…å«å…ƒæ•°æ®)
- **LSMç‰¹æ€§**: åºåˆ—å·ã€å¢“ç¢‘æ ‡è®°ã€ä¸å¯å˜çŠ¶æ€
- **é€‚ç”¨åœºæ™¯**: å†™å¯†é›†å‹åº”ç”¨ã€æ—¥å¿—ç³»ç»Ÿã€æ—¶åºæ•°æ®

### B+Treeå­˜å‚¨å¼•æ“ â­ **å¹³è¡¡è¯»å†™æ¨è**
- **ååé‡**: 832,484 ops/sec (8çº¿ç¨‹å¹¶å‘)
- **å•çº¿ç¨‹æ€§èƒ½**: 105,000-110,000 ops/sec  
- **å†…å­˜æ•ˆç‡**: ä»…4-5%é¢å¤–å¼€é”€
- **å¹¶å‘å®‰å…¨**: ç¨³å®šçš„çº¿ç¨‹å®‰å…¨æ€§
- **å»¶è¿Ÿ**: äºšæ¯«ç§’çº§å“åº”

### Hashå­˜å‚¨å¼•æ“
- **å†™å…¥æ€§èƒ½**: 1,460,000 ops/sec
- **è¯»å–æ€§èƒ½**: O(1)å¹³å‡å¤æ‚åº¦
- **å†…å­˜ä½¿ç”¨**: åŠ¨æ€æ‰©å±•

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åº”ç”¨å±‚ (Client)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  é…ç½®ç®¡ç†å±‚ ğŸ”§                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ kv_engine_config.h - ç»Ÿä¸€é…ç½®ç®¡ç†ç³»ç»Ÿ              â”‚â”‚
â”‚  â”‚ å¤šå¼•æ“ç®¡ç† | è¿è¡Œæ—¶åˆ‡æ¢ | JSON/ç¯å¢ƒå˜é‡é…ç½®        â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  ç»Ÿä¸€å¼•æ“æ¥å£å±‚                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ kv_engine_interface.h - ç»Ÿä¸€å­˜å‚¨å¼•æ“æ¥å£           â”‚â”‚
â”‚  â”‚ kv_engine_factory.c - å­˜å‚¨å¼•æ“å·¥å‚æ¨¡å¼              â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   å­˜å‚¨å¼•æ“å±‚                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Array   â”‚ â”‚  Hash   â”‚ â”‚ RBTree  â”‚ â”‚ B+Tree â­   â”‚   â”‚
â”‚  â”‚ Engine  â”‚ â”‚ Engine  â”‚ â”‚ Engine  â”‚ â”‚ Engine      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚           LSM-Treeå­˜å‚¨å¼•æ“ ğŸ”¥                      â”‚â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚
â”‚  â”‚    â”‚MemTable   â”‚ â”‚ SSTable     â”‚ â”‚ Compaction   â”‚  â”‚â”‚
â”‚  â”‚    â”‚(å·²å®Œæˆ)   â”‚ â”‚ (å·²å®Œæˆ)    â”‚ â”‚ (å·²å®Œæˆ)     â”‚  â”‚â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚
â”‚  â”‚    â”‚      æ‰¹é‡å†™å…¥ä¼˜åŒ– âš¡ (å·²å®Œæˆ)               â”‚  â”‚â”‚
â”‚  â”‚    â”‚  æ™ºèƒ½å»é‡ | å®¹é‡ç®¡ç† | å¹¶å‘å®‰å…¨ | WALé›†æˆ  â”‚  â”‚â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  äº‹åŠ¡ä¸å¹¶å‘æ§åˆ¶å±‚                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ 2PCåˆ†å¸ƒå¼äº‹åŠ¡ â”‚ æ­»é”æ£€æµ‹ â”‚ ä¼˜å…ˆçº§è°ƒåº¦ â”‚ è¶…æ—¶å¤„ç†    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    æŒä¹…åŒ–å±‚                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ WALæ—¥å¿— â”‚ å¿«ç…§å¤‡ä»½ â”‚ æ•…éšœæ¢å¤ â”‚ æ•°æ®å‹ç¼©           â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    ç½‘ç»œå±‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ TCP/UDP â”‚ Epoll â”‚ è¿æ¥æ±  â”‚ è´Ÿè½½å‡è¡¡               â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- **æ“ä½œç³»ç»Ÿ**: Linux (æ¨èUbuntu 18.04+, CentOS 7+)
- **ç¼–è¯‘å™¨**: GCC 7.0+ æˆ– Clang 6.0+
- **ä¾èµ–**: pthread, libc
- **å†…å­˜**: æœ€å°512MBï¼Œæ¨è2GB+
- **å­˜å‚¨**: è‡³å°‘1GBå¯ç”¨ç©ºé—´

### ç¼–è¯‘å®‰è£…

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/Lzww0608/ConcordKV.git
cd ConcordKV

# ç¼–è¯‘é¡¹ç›®
cd kvserver
make all

# è¿è¡Œæµ‹è¯•
make test_all

# å®‰è£…åˆ°ç³»ç»Ÿ (å¯é€‰)
sudo make install
```

### åŸºç¡€ä½¿ç”¨ç¤ºä¾‹

```c
#include "kv_engine_interface.h"
#include "kv_engine_factory.h"

int main() {
    // åˆ›å»ºB+Treeå­˜å‚¨å¼•æ“å®ä¾‹
    kv_engine_t *engine = kv_engine_factory_create(KV_ENGINE_BTREE);
    
    // åˆå§‹åŒ–å¼•æ“
    if (engine->init(engine, NULL) != 0) {
        fprintf(stderr, "å¼•æ“åˆå§‹åŒ–å¤±è´¥\n");
        return -1;
    }
    
    // å­˜å‚¨æ•°æ®
    engine->set(engine, "user:1001", "å¼ ä¸‰");
    engine->set(engine, "user:1002", "æå››");
    
    // æ£€ç´¢æ•°æ®
    char *value = engine->get(engine, "user:1001");
    printf("ç”¨æˆ·ä¿¡æ¯: %s\n", value);
    free(value);
    
    // ç»Ÿè®¡ä¿¡æ¯
    size_t count = engine->count(engine);
    printf("æ€»è®°å½•æ•°: %zu\n", count);
    
    // æ¸…ç†èµ„æº
    engine->destroy(engine);
    kv_engine_factory_destroy(engine);
    
    return 0;
}
```

### LSM-Tree MemTableä½¿ç”¨ç¤ºä¾‹

```c
#include "lsm_memtable.h"

int main() {
    // åˆ›å»ºMemTable (4MBæœ€å¤§å¤§å°)
    lsm_memtable_t *memtable = lsm_memtable_create(4 * 1024 * 1024, "user_data");
    
    // å†™å…¥æ•°æ® (é«˜æ€§èƒ½å†™å…¥)
    lsm_memtable_put(memtable, "log:001", 7, "user login", 10);
    lsm_memtable_put(memtable, "log:002", 7, "user logout", 11);
    
    // è¯»å–æ•°æ®
    char *value = NULL;
    size_t value_len;
    uint64_t seq_num;
    bool deleted;
    
    int ret = lsm_memtable_get(memtable, "log:001", 7, &value, &value_len, &seq_num, &deleted);
    if (ret == 0 && !deleted) {
        printf("æ—¥å¿—å†…å®¹: %s (åºåˆ—å·: %lu)\n", value, seq_num);
        free(value);
    }
    
    // åˆ é™¤æ“ä½œ (å¢“ç¢‘æ ‡è®°)
    lsm_memtable_delete(memtable, "log:001", 7);
    
    // è·å–ç»Ÿè®¡ä¿¡æ¯
    lsm_memtable_stats_t stats;
    lsm_memtable_get_stats(memtable, &stats);
    printf("æ€»æ¡ç›®: %lu, æ´»è·ƒ: %lu, å·²åˆ é™¤: %lu\n", 
           stats.total_entries, stats.active_entries, stats.deleted_entries);
    
    // å†»ç»“ä¸ºä¸å¯å˜çŠ¶æ€ (å‡†å¤‡åˆ·å†™åˆ°ç£ç›˜)
    lsm_memtable_freeze(memtable);
    
    // æ¸…ç†èµ„æº
    lsm_memtable_destroy(memtable);
    
    return 0;
}
```

### LSM-Treeæ‰¹é‡å†™å…¥ä¼˜åŒ–ç¤ºä¾‹ âš¡ **æ–°å¢**

```c
#include "lsm_batch_writer.h"

int main() {
    // åˆ›å»ºLSM-Treeå®ä¾‹
    lsm_tree_t *lsm_tree = lsm_tree_create(&config);
    
    // åˆ›å»ºæ‰¹é‡å†™å…¥å™¨
    lsm_batch_config_t batch_config = {
        .max_batch_size = 1000,        // æœ€å¤§æ‰¹é‡å¤§å°
        .max_batch_memory = 1024*1024, // æœ€å¤§å†…å­˜ä½¿ç”¨é‡(1MB)
        .enable_dedup = true           // å¯ç”¨æ™ºèƒ½å»é‡
    };
    
    lsm_batch_writer_t *writer = lsm_batch_writer_create(lsm_tree, &batch_config);
    
    // æ‰¹é‡æ·»åŠ æ“ä½œ (é«˜æ€§èƒ½æ‰¹é‡å†™å…¥)
    for (int i = 0; i < 1000; i++) {
        char key[32], value[64];
        snprintf(key, sizeof(key), "user:%d", i);
        snprintf(value, sizeof(value), "userdata_%d", i);
        
        lsm_batch_put(writer, key, strlen(key), value, strlen(value));
    }
    
    // æ·»åŠ åˆ é™¤æ“ä½œ (æ”¯æŒæ‰¹é‡åˆ é™¤)
    lsm_batch_delete(writer, "user:100", 8);  // åˆ é™¤ç”¨æˆ·100
    lsm_batch_delete(writer, "user:200", 8);  // åˆ é™¤ç”¨æˆ·200
    
    // é‡å¤é”®æ“ä½œ (æ™ºèƒ½å»é‡ï¼Œä¿ç•™æœ€æ–°å€¼)
    lsm_batch_put(writer, "user:999", 8, "old_value", 9);
    lsm_batch_put(writer, "user:999", 8, "new_value", 9);  // è¿™ä¸ªä¼šè¢«ä¿ç•™
    
    // æäº¤æ‰¹é‡æ“ä½œ (åŸå­æ€§æäº¤)
    lsm_batch_result_t result;
    int ret = lsm_batch_commit(writer, &result);
    
    if (ret == KV_ERR_NONE) {
        printf("æ‰¹é‡å†™å…¥æˆåŠŸï¼\n");
        printf("  - æ€»æ“ä½œæ•°: %zu\n", result.total_ops);
        printf("  - å»é‡åæ“ä½œæ•°: %zu\n", result.actual_ops);
        printf("  - æäº¤æ—¶é—´: %.2f ms\n", result.commit_time_ms);
        printf("  - WALå†™å…¥æ•°: %zu\n", result.wal_writes);
    }
    
    // æ¸…ç†èµ„æº
    lsm_batch_writer_destroy(writer);
    lsm_tree_destroy(lsm_tree);
    
    return 0;
}
```

### é…ç½®ç³»ç»Ÿä½¿ç”¨ç¤ºä¾‹ ğŸ”§ **æ–°å¢**

```c
#include "kv_engine_config.h"

int main() {
    // 1. åˆ›å»ºå…¨å±€é…ç½®
    kv_engine_global_config_t *config = kv_engine_global_config_create();
    
    // 2. ä»JSONæ–‡ä»¶åŠ è½½é…ç½®
    kv_engine_global_config_t *file_config = kv_engine_config_load_from_file("engine_config.json");
    if (file_config) {
        printf("ä»é…ç½®æ–‡ä»¶åŠ è½½æˆåŠŸ\n");
        config = file_config;
    }
    
    // 3. ä»ç¯å¢ƒå˜é‡åŠ è½½é…ç½® (ä¼˜å…ˆçº§æ›´é«˜)
    kv_engine_config_load_from_env(config, "CONCORD_");
    
    // 4. åˆ›å»ºå¼•æ“ç®¡ç†å™¨
    kv_engine_manager_t *manager = kv_engine_manager_create(config);
    
    // 5. åˆå§‹åŒ–æ‰€æœ‰é…ç½®çš„å¼•æ“
    if (kv_engine_manager_init_engines(manager) == 0) {
        printf("å¼•æ“åˆå§‹åŒ–æˆåŠŸ\n");
        
        // 6. ä½¿ç”¨é»˜è®¤å¼•æ“è¿›è¡Œæ“ä½œ
        kv_engine_t *current = kv_engine_manager_get_current(manager);
        current->vtable->set(current, "user:001", "å¼ ä¸‰");
        
        // 7. è¿è¡Œæ—¶åˆ‡æ¢åˆ°ä¸åŒå¼•æ“
        printf("åˆ‡æ¢åˆ°Hashå¼•æ“...\n");
        kv_engine_manager_switch_engine(manager, KV_ENGINE_HASH);
        
        current = kv_engine_manager_get_current(manager);
        current->vtable->set(current, "user:002", "æå››");
        
        // 8. åˆ‡æ¢åˆ°B+Treeå¼•æ“
        printf("åˆ‡æ¢åˆ°B+Treeå¼•æ“...\n");
        kv_engine_manager_switch_engine(manager, KV_ENGINE_BTREE);
        
        current = kv_engine_manager_get_current(manager);
        char *value = current->vtable->get(current, "user:001");
        printf("æŸ¥è¯¢ç»“æœ: %s\n", value ? value : "æœªæ‰¾åˆ°");
        
        // 9. è·å–ç»Ÿè®¡ä¿¡æ¯
        kv_engine_stats_t stats;
        kv_engine_manager_get_stats(manager, &stats);
        printf("æ€»æ“ä½œæ•°: %lu, å¼•æ“åˆ‡æ¢æ¬¡æ•°: %lu\n", 
               stats.total_operations, stats.engine_switches);
    }
    
    // 10. æ¸…ç†èµ„æº
    kv_engine_manager_destroy(manager);
    kv_engine_global_config_destroy(config);
    
    return 0;
}
```

**é…ç½®æ–‡ä»¶ç¤ºä¾‹ (engine_config.json):**
```json
{
    "strategy": "adaptive",
    "default_engine": "hash",
    "worker_threads": 8,
    "listen_port": 6379,
    "data_directory": "./data",
    "enable_statistics": true,
    "global_memory_limit": 268435456,
    "engines": {
        "hash": {
            "memory_limit": 67108864,
            "cache_size": 16777216
        },
        "btree": {
            "memory_limit": 134217728,
            "cache_size": 33554432,
            "order": 100
        }
    }
}
```

**ç¯å¢ƒå˜é‡é…ç½®ç¤ºä¾‹:**
```bash
export CONCORD_DEFAULT_ENGINE=btree
export CONCORD_LISTEN_PORT=8080
export CONCORD_DATA_DIR=/var/lib/concordkv
export CONCORD_WORKER_THREADS=16
```

### é«˜çº§åŠŸèƒ½ç¤ºä¾‹

```c
// äº‹åŠ¡ç¤ºä¾‹
kv_transaction_t *tx = kv_transaction_begin(engine);
kv_transaction_set(tx, "account:001", "1000");
kv_transaction_set(tx, "account:002", "2000");
if (kv_transaction_commit(tx) == 0) {
    printf("äº‹åŠ¡æäº¤æˆåŠŸ\n");
}

// æ‰¹é‡æ“ä½œç¤ºä¾‹
const char *keys[] = {"key1", "key2", "key3"};
const char *values[] = {"val1", "val2", "val3"};
engine->batch_set(engine, keys, values, 3);
```

## ğŸ§ª æµ‹è¯•å¥—ä»¶

é¡¹ç›®æä¾›å®Œæ•´çš„æµ‹è¯•ä½“ç³»ï¼ŒæŒ‰å­˜å‚¨å¼•æ“åˆ†ç±»ç»„ç»‡ï¼š

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
make test_by_category

# åˆ†ç±»æµ‹è¯•
make run_config_test       # é…ç½®ç³»ç»Ÿæµ‹è¯• ğŸ”§
make run_btree_test        # B+Treeå­˜å‚¨å¼•æ“æµ‹è¯•
make run_production_test   # B+Treeç”Ÿäº§çº§æ£€æŸ¥
make test_lsm_memtable     # LSM-Tree MemTableæµ‹è¯• ğŸ”¥
make test_hash            # Hashå­˜å‚¨å¼•æ“æµ‹è¯•  
make test_rbtree          # RBTreeå­˜å‚¨å¼•æ“æµ‹è¯•
make test_array           # Arrayå­˜å‚¨å¼•æ“æµ‹è¯•
make test_system          # ç³»ç»ŸåŠŸèƒ½æµ‹è¯•

# æ€§èƒ½æµ‹è¯•
make perf_test

# å†…å­˜æ£€æŸ¥
make memcheck
```

### æµ‹è¯•ç›®å½•ç»“æ„
```
tests/kvserver_tests/
â”œâ”€â”€ config_tests/         # é…ç½®ç³»ç»Ÿæµ‹è¯• ğŸ”§
â”œâ”€â”€ lsm_tests/            # LSM-Tree MemTableæµ‹è¯• ğŸ”¥
â”œâ”€â”€ btree_tests/          # B+Treeå­˜å‚¨å¼•æ“æµ‹è¯•
â”œâ”€â”€ hash_tests/           # Hashå­˜å‚¨å¼•æ“æµ‹è¯•
â”œâ”€â”€ rbtree_tests/         # RBTreeå­˜å‚¨å¼•æ“æµ‹è¯•  
â”œâ”€â”€ array_tests/          # Arrayå­˜å‚¨å¼•æ“æµ‹è¯•
â”œâ”€â”€ system_tests/         # ç³»ç»ŸåŠŸèƒ½æµ‹è¯•
â””â”€â”€ engine_tests/         # å¼•æ“æ¥å£æµ‹è¯•
```

## ğŸ“š æ–‡æ¡£

- [å¼€å‘è·¯çº¿å›¾](docs/ROADMAP.md) - é¡¹ç›®å‘å±•è®¡åˆ’å’Œè¿›åº¦
- [APIæ–‡æ¡£](docs/API.md) - è¯¦ç»†çš„APIä½¿ç”¨è¯´æ˜
- [æ¶æ„è®¾è®¡](docs/ARCHITECTURE.md) - ç³»ç»Ÿæ¶æ„å’Œè®¾è®¡ç†å¿µ
- [é…ç½®æŒ‡å—](docs/CONFIG.md) - é…ç½®å‚æ•°è¯´æ˜
- [éƒ¨ç½²æŒ‡å—](docs/DEPLOYMENT.md) - ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å—
- [è´¡çŒ®æŒ‡å—](docs/CONTRIBUTING.md) - å¦‚ä½•å‚ä¸é¡¹ç›®å¼€å‘

## ğŸ¯ è·¯çº¿å›¾äº®ç‚¹

### âœ… å·²å®Œæˆ (Phase 2.1 - B+Treeå­˜å‚¨å¼•æ“)
- **æ ¸å¿ƒB+Treeå®ç°** - å®Œæ•´çš„B+Treeæ•°æ®ç»“æ„
- **é€‚é…å™¨å±‚é›†æˆ** - ä¸ç»Ÿä¸€æ¥å£æ— ç¼é›†æˆ  
- **ç”Ÿäº§çº§æµ‹è¯•** - 100%æµ‹è¯•é€šè¿‡ï¼Œ832K ops/secæ€§èƒ½
- **å¹¶å‘å®‰å…¨æ€§** - 8çº¿ç¨‹ç¨³å®šå¹¶å‘æµ‹è¯•
- **å†…å­˜é«˜æ•ˆæ€§** - ä»…4-5%å†…å­˜å¼€é”€

### ğŸš§ å¼€å‘ä¸­ (Phase 3 - LSM-Treeå­˜å‚¨å¼•æ“)
- **MemTableå®ç°** - å†…å­˜è¡¨å’Œä¸å¯å˜å†…å­˜è¡¨
- **SSTableæ–‡ä»¶æ ¼å¼** - é«˜æ•ˆçš„ç£ç›˜å­˜å‚¨æ ¼å¼
- **å‹ç¼©æœºåˆ¶** - Level-0å’ŒLevel-Nå‹ç¼©ç­–ç•¥
- **å†™å…¥ä¼˜åŒ–** - é¢å‘å†™å¯†é›†å‹åœºæ™¯çš„ä¼˜åŒ–

### ğŸ”® è§„åˆ’ä¸­
- **åˆ†å¸ƒå¼æ‰©å±•** - æ°´å¹³æ‰©å±•å’Œæ•°æ®åˆ†ç‰‡
- **SQLæ¥å£** - ç±»SQLæŸ¥è¯¢è¯­è¨€æ”¯æŒ
- **æœºå™¨å­¦ä¹ é›†æˆ** - æ™ºèƒ½ç¼“å­˜å’Œè´Ÿè½½é¢„æµ‹

## ğŸ“Š åŸºå‡†æµ‹è¯•

### ç¯å¢ƒé…ç½®
- **CPU**: Intel Xeon E5-2686 v4 @ 2.3GHz
- **å†…å­˜**: 16GB DDR4
- **å­˜å‚¨**: SSD 500GB
- **ç½‘ç»œ**: 1Gbps Ethernet

### æ€§èƒ½å¯¹æ¯” (å•èŠ‚ç‚¹)

| å­˜å‚¨å¼•æ“ | å†™å…¥ (ops/sec) | è¯»å– (ops/sec) | å†…å­˜å¼€é”€ | å¹¶å‘å®‰å…¨ |
|----------|----------------|----------------|----------|----------|
| B+Tree â­ | 832,484        | 1,100,000+     | 4-5%     | âœ… è‰¯å¥½  |
| Hash     | 1,460,000      | 1,800,000      | 15-20%   | âœ… è‰¯å¥½  |
| RBTree   | 450,000        | 650,000        | 8-12%    | âœ… è‰¯å¥½  |
| Array    | 2,000,000      | 2,500,000      | 0%       | âš ï¸ åŸºç¡€   |

## ğŸ¤ è´¡çŒ®

æ¬¢è¿å„ç§å½¢å¼çš„è´¡çŒ®ï¼

### è´¡çŒ®æ–¹å¼
- ğŸ› **BugæŠ¥å‘Š** - é€šè¿‡IssueæŠ¥å‘Šé—®é¢˜
- ğŸ’¡ **åŠŸèƒ½å»ºè®®** - æå‡ºæ–°åŠŸèƒ½æƒ³æ³•
- ğŸ“ **æ–‡æ¡£æ”¹è¿›** - å®Œå–„æ–‡æ¡£å’Œç¤ºä¾‹
- ğŸ”§ **ä»£ç è´¡çŒ®** - æäº¤Pull Request

### å¼€å‘æµç¨‹
1. Forké¡¹ç›®å¹¶åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
2. ç¡®ä¿ä»£ç ç¬¦åˆé¡¹ç›®è§„èŒƒ
3. æ·»åŠ æµ‹è¯•ç”¨ä¾‹å’Œæ–‡æ¡£
4. é€šè¿‡æ‰€æœ‰CIæ£€æŸ¥
5. æäº¤Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨[MIT License](LICENSE)å¼€æºåè®®ã€‚


## ğŸ“ è”ç³»æˆ‘ä»¬

- **é¡¹ç›®ä¸»é¡µ**: https://github.com/Lzww0608/ConcordKV
- **é—®é¢˜åé¦ˆ**: https://github.com/Lzww0608/ConcordKV/issues

---

â­ **å¦‚æœæ‚¨è§‰å¾—ConcordKVæœ‰ç”¨ï¼Œè¯·ç»™æˆ‘ä¸€ä¸ªStarï¼**

